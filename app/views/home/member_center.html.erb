<!-- Top Header -->
<div class="container-fluid bg-dark-gray-blue text-white py-3">
  <div class="default-padding-left">
    <h1 class="text-left font-primary-title"> Member Center | Welcome <%= @user.first_name %>! </h1>
  </div>
</div>


<!-- Main Body Split -->
<div class="container-fluid bg-gold py-2">
  <div class="row flex-grow-1">

    <!-- Left Column Containing Photo Gallery, Caption, Sign Out, Exec Buttons -->
    <div class="col-md-5 bg-legion-blue py-4 px-4">
    <div class="default-padding-left">

      <!-- Sign Out + Manage Gallery Buttons -->
      <div class="d-grid gap-3 mb-4">
        <%= button_to "Sign out", destroy_user_session_path,
          method: :delete,
          form: { "data-turbo": "false" },
          class: "btn white-btn-edit btn-lg w-100 font-primary-heading default-border-radius" %>

        <% if @user.exec? || @user.president? %>
          <%= link_to "Manage Gallery & Caption", "#",
            class: "btn white-btn-edit btn-lg w-100 font-primary-heading default-border-radius",
            data: { bs_toggle: "modal", bs_target: "#manageGalleryModal" } %>
        <% end %>
      </div>


        <!-- Photo Gallery Carousel -->
        <div id="memberPhotoCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
          <div class="carousel-inner">
            <% @shared_user.gallery_photos.each_with_index do |photo, index| %>
              <div class="carousel-item <%= 'active' if index == 0 %> text-center">
                <%= image_tag(url_for(photo.variant(resize_to_limit: [1600, 1600], sharpen: "0x1.5").processed),
                    class: "d-block mx-auto img-fluid shadow-sm", alt: "Gallery Photo") %>
                
                <!-- Delete Button for Exec/President -->
                <% if @user.exec? || @user.president? %>
                  <%= button_to "Ã—",
                      delete_gallery_photo_path(photo_id: photo.id),
                      method: :delete, data: { confirm: "Are you sure you want to delete this photo?" },
                      class: "position-absolute top-0 end-0 btn btn-sm btn-gold text-dark-navy p-1" %>
                <% end %>
              </div>
            <% end %>
          </div>

          <!-- PhotoCarousel Controls -->
          <button class="carousel-control-prev" type="button" data-bs-target="#memberPhotoCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#memberPhotoCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <!-- Legion Photo Gallery Caption Container -->
        <div class="caption-container py-2 px-3 mb-3 text-center font-secondary-subheading">
          <%= member_center_caption_text %>
        </div>
      </div>
    </div>


    <!-- Right Column Containg Quick Links and Admin Access -->
    <div class="col-md-7 bg-dark-navy text-white py-4 px-4">
      <div class="default-padding-right">
        <div class="mb-5">
          <div class="mb-5">
            <!-- Quick Links Section -->
            <h2 class="mb-2 font-primary-title">Quick Links</h2>
            <hr class="thick-white-divider mb-3">

            <% quick_links = [
                ["Resources", resources_path],
                ["View Service Hours", services_path],
                ["Submit Service Hours", new_service_path],
                ["Google Photos", "#"],
                ["Upcoming Events", events_path],
                ["Member Directory", "#"]
              ] %>

            <div class="row g-3 mb-4">
              <% quick_links.each do |name, path| %>
                <div class="col-12 col-sm-6 col-md-4 col-lg-4">
                  <%= link_to name, path, class: "btn white-btn-member-center font-primary-heading w-100" %>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Admin Access Section (Exec/President Only) -->
          <% if @user.exec? || @user.president? %>
            <h2 class="mb-2 font-primary-title">Admin Access</h2>
            <hr class="thick-white-divider mb-3">

            <% admin_links = [
                ["Events Dashboard", dashboard_events_path],
                ["Resources Dashboard", dashboard_resources_path],
                ["Service Dashboard", services_dashboard_path],
                ["Members Dashboard", users_path],
                ["Committees Dashboard", '#'],
                ["Edit Home Page", edit_home_path],
                ["Edit About Us Page", edit_about_path],
                ["Edit Recruitment Page", edit_recruitment_path],
                ["Edit Contact Us Page", edit_contact_path],
                ["Admin User Guide", "#"]
              ] %>

            <div class="row g-3">
              <% admin_links.each do |name, path| %>
                <div class="col-12 col-sm-6 col-md-4 col-lg-4">
                  <%= link_to name, path,
                      class: "btn white-btn-member-center font-primary-heading w-100",
                      data: (name == "Admin User Guide" ? { bs_toggle: "modal", bs_target: "#pageManagementModal" } : {}) %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
  </div>
</div>


<!--  Pop-up Modals -->
<!-- Combined Photo Gallery & Caption Modal -->
<div class="modal fade edit-info-modal" id="manageGalleryModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content p-3">
      <div class="modal-header border-0">
        <h5 class="modal-title">Manage Photo Gallery & Caption</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">

        <!-- Upload New Photos -->
        <%= form_with url: upload_gallery_path, method: :post, local: true, html: { multipart: true } do |f| %>
          <div class="mb-3">
            <label class="form-label font-primary-heading">Upload New Photos</label>
            <%= f.file_field :gallery_photos, multiple: true, class: "form-control bg-dark-navy text-white default-border-radius" %>
          </div>

        <!-- Current Uploaded Photos -->
        <div class="current-photos mt-4">
          <h6 class="font-primary-heading">Current Uploaded Photos</h6>
          <ul class="list-group list-group-flush">
            <% @gallery_photos.each do |photo| %>
              <li class="list-group-item bg-dark-navy text-white d-flex justify-content-between align-items-center mb-2" style="border: 1px solid white;">
                <span><%= photo.filename.to_s %></span>
              </li>
            <% end %>
          </ul>
        </div>

          <div class="text-end mt-3">
            <%= f.submit "Upload Photos", class: "btn btn-gold text-dark-navy font-secondary-body" %>
          </div>
        <% end %>

        <hr class="my-4" style="border-color: white;">

        <!-- Edit Gallery Caption -->
        <%= form_with url: update_member_center_caption_path, method: :post, local: true do |f| %>
          <div class="mb-3 form-dark-navy">
            <label class="form-label font-primary-heading">Edit Gallery Caption (HTML allowed)</label>
            <%= f.text_area :text, value: member_center_caption_text, class: "form-control bg-dark-navy text-white default-border-radius", rows: 3 %>
          </div>

          <div class="text-end">
            <%= f.submit "Save Caption", class: "btn btn-gold text-dark-navy font-secondary-body" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

  <!-- Page Management Modal -->
  <div class="modal fade" id="pageManagementModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-dark-navy text-white border-1 default-border-radius", style="border: 1px solid white;">
        <div class="modal-header border-1">
          <h5 class="modal-title">Admin User Guide</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Welcome to the User Guide. As an Admin, you have access to the following features:</p>
          <ul>
            <li>Editing Public-facing views</li>
            <li>Updating Member data and proccessing requests</li>
            <li>Managing resources, events, and other member center features</li>
          </ul>
          <p>For additional guidance on how to use the Member Center, please refer to the User Guide below.</p>
        <div class="modal-footer">
          <a href="/Files/Legion_Website_Help_Guide_V.2.pdf" target="_blank" class="btn btn-gold font-secondary-body">Open User Guide (PDF)</a>
          <button type="button" class="btn btn-gold text-dark-navy font-secondary-body" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
